<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example of 2D Graph Modality &mdash; MolScaling 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Experiments" href="run.html" />
    <link rel="prev" title="Prepare Environment" href="environment.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            MolScaling
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Prepare Environment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example of 2D Graph Modality</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#1.-Define-the-basic-functions-we-need-to-use.">1. Define the basic functions we need to use.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Load-dataset-and-partition-it-with-random-split.-You-can-also-easily-replace-it-with-other-split-methods-(scaffold-and-imbalanced).">2. Load dataset and partition it with random split. You can also easily replace it with other split methods (scaffold and imbalanced).</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Randomly-select-partial-training-set-(1%,-5%,-10%,-...,-100%)-for-model-training.">3. Randomly select partial training set (1%, 5%, 10%, …, 100%) for model training.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#4.-Setup-backbone-model-and-optimizer">4. Setup backbone model and optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#5.-Train-and-evaluate-the-model.">5. Train and evaluate the model.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#6.-Gather-the-results-from-5-independent-runs.">6. Gather the results from 5 independent runs.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#7.-Fit-the-curve-and-plot-the-neural-scaling-law.">7. Fit the curve and plot the neural scaling law.</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Experiments</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="run.html">Experiments</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Dataset Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="model.html">Model Classes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MolScaling</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Example of 2D Graph Modality</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Example-of-2D-Graph-Modality">
<h1>Example of 2D Graph Modality<a class="headerlink" href="#Example-of-2D-Graph-Modality" title="Permalink to this headline"></a></h1>
<p>Here we provide the example code for exploring the neural scaling law of 2D Graph Modality with GIN backbone. You can easily compare this example to other modality (Fingerprint, SMILES string and 3D graph) since we use similar code framework.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">from</span> <span class="nn">torch_geometric.nn</span> <span class="kn">import</span> <span class="n">global_mean_pool</span>
<span class="kn">from</span> <span class="nn">torch_geometric.loader</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">splitter</span> <span class="kn">import</span> <span class="n">random_split</span>


<span class="kn">from</span> <span class="nn">datasets.molnet</span> <span class="kn">import</span> <span class="n">MoleculeDataset</span>
<span class="kn">from</span> <span class="nn">model.gnn</span> <span class="kn">import</span> <span class="n">GNN</span>
<span class="kn">from</span> <span class="nn">model.mlp</span> <span class="kn">import</span> <span class="n">MLP</span>
</pre></div>
</div>
</div>
<section id="1.-Define-the-basic-functions-we-need-to-use.">
<h2>1. Define the basic functions we need to use.<a class="headerlink" href="#1.-Define-the-basic-functions-we-need-to-use." title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">seed</span><span class="p">:</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ Using Seed : &quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="s2">&quot; ]&quot;</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">get_num_task</span><span class="p">(</span><span class="n">dataset</span><span class="p">):</span>
    <span class="c1"># Get output dimensions of different tasks</span>
    <span class="k">if</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s1">&#39;tox21&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">12</span>
    <span class="k">elif</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hiv&#39;</span><span class="p">,</span> <span class="s1">&#39;bace&#39;</span><span class="p">,</span> <span class="s1">&#39;bbbp&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s1">&#39;muv&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">17</span>
    <span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s1">&#39;toxcast&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">617</span>
    <span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s1">&#39;sider&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">27</span>
    <span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s1">&#39;clintox&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="s1">&#39;pcba&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">92</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid dataset name.&#39;</span><span class="p">)</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ Using Seed :  0  ]
</pre></div></div>
</div>
</section>
<section id="2.-Load-dataset-and-partition-it-with-random-split.-You-can-also-easily-replace-it-with-other-split-methods-(scaffold-and-imbalanced).">
<h2>2. Load dataset and partition it with random split. You can also easily replace it with other split methods (scaffold and imbalanced).<a class="headerlink" href="#2.-Load-dataset-and-partition-it-with-random-split.-You-can-also-easily-replace-it-with-other-split-methods-(scaffold-and-imbalanced)." title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_name</span> <span class="o">=</span> <span class="s1">&#39;hiv&#39;</span>
<span class="n">split</span> <span class="o">=</span> <span class="s1">&#39;random&#39;</span>
<span class="n">num_tasks</span> <span class="o">=</span> <span class="n">get_num_task</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">)</span>
<span class="c1"># Set your dataset directory</span>
<span class="n">dataset_folder</span> <span class="o">=</span> <span class="s1">&#39;/home/YourDir/datasets/molecule_net/&#39;</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">MoleculeDataset</span><span class="p">(</span><span class="n">dataset_folder</span> <span class="o">+</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
<span class="n">eval_metric</span> <span class="o">=</span> <span class="n">roc_auc_score</span>

<span class="k">if</span> <span class="n">split</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">:</span>
    <span class="n">smiles_list</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">dataset_folder</span> <span class="o">+</span> <span class="n">dataset_name</span> <span class="o">+</span> <span class="s1">&#39;/processed/smiles.csv&#39;</span><span class="p">,</span>
                                <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">train_dataset</span><span class="p">,</span> <span class="n">valid_dataset</span><span class="p">,</span> <span class="n">test_dataset</span><span class="p">,</span> <span class="p">(</span><span class="n">train_smiles</span><span class="p">,</span> <span class="n">valid_smiles</span><span class="p">,</span> <span class="n">test_smiles</span><span class="p">),</span><span class="n">_</span> <span class="o">=</span> <span class="n">random_split</span><span class="p">(</span>
        <span class="n">dataset</span><span class="p">,</span> <span class="n">null_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">frac_train</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">frac_valid</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">frac_test</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">smiles_list</span><span class="o">=</span><span class="n">smiles_list</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;randomly split&#39;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid split option.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training data length: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_smiles</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset: hiv
Data: Data(x=[1049163, 2], edge_index=[2, 2259376], edge_attr=[2259376, 2], id=[41127], fingerprint=[41127, 1024], y=[41127])
MoleculeDataset(41127)
randomly split
Data(y=[1], x=[39, 2], edge_index=[2, 84], fingerprint=[1, 1024], edge_attr=[84, 2], id=[1])
Training data length: 32901
</pre></div></div>
</div>
</section>
<section id="3.-Randomly-select-partial-training-set-(1%,-5%,-10%,-...,-100%)-for-model-training.">
<h2>3. Randomly select partial training set (1%, 5%, 10%, …, 100%) for model training.<a class="headerlink" href="#3.-Randomly-select-partial-training-set-(1%,-5%,-10%,-...,-100%)-for-model-training." title="Permalink to this headline"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">finetune_ratio</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">256</span>
<span class="n">finetune_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">finetune_ratio</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_smiles</span><span class="p">))</span>
<span class="n">num_mols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">all_idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_mols</span><span class="p">))</span>
<span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">all_idx</span><span class="p">)</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">all_idx</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="n">finetune_ratio</span> <span class="o">*</span> <span class="n">num_mols</span><span class="p">)]</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="n">ids</span><span class="p">]</span>

<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">val_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">valid_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                        <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">test_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="4.-Setup-backbone-model-and-optimizer">
<h2>4. Setup backbone model and optimizer<a class="headerlink" href="#4.-Setup-backbone-model-and-optimizer" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_layer</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">emb_dim</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">dropout_ratio</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">lr</span> <span class="o">=</span> <span class="mf">1e-3</span>

<span class="n">model_param_group</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">GNN</span><span class="p">(</span><span class="n">num_layer</span><span class="o">=</span><span class="n">num_layer</span><span class="p">,</span> <span class="n">emb_dim</span><span class="o">=</span><span class="n">emb_dim</span><span class="p">,</span> <span class="n">drop_ratio</span><span class="o">=</span><span class="n">dropout_ratio</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">output_layer</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="n">emb_dim</span><span class="p">,</span> <span class="n">hidden_channels</span><span class="o">=</span><span class="n">emb_dim</span><span class="p">,</span>
                    <span class="n">out_channels</span><span class="o">=</span><span class="n">num_tasks</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="n">model_param_group</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">output_layer</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="n">lr</span><span class="p">})</span>
<span class="n">model_param_group</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;params&#39;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="s1">&#39;lr&#39;</span><span class="p">:</span> <span class="n">lr</span><span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model_param_group</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GNN(
  (x_embedding1): Embedding(120, 300)
  (x_embedding2): Embedding(3, 300)
  (gnns): ModuleList(
    (0): GINConv()
    (1): GINConv()
    (2): GINConv()
    (3): GINConv()
    (4): GINConv()
  )
  (batch_norms): ModuleList(
    (0): BatchNorm1d(300, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (1): BatchNorm1d(300, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (2): BatchNorm1d(300, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (3): BatchNorm1d(300, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
    (4): BatchNorm1d(300, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)
  )
)
</pre></div></div>
</div>
</section>
<section id="5.-Train-and-evaluate-the-model.">
<h2>5. Train and evaluate the model.<a class="headerlink" href="#5.-Train-and-evaluate-the-model." title="Permalink to this headline"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">BCEWithLogitsLoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">train_roc_list</span><span class="p">,</span> <span class="n">val_roc_list</span><span class="p">,</span> <span class="n">test_roc_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">train_loss_list</span><span class="p">,</span> <span class="n">val_loss_list</span><span class="p">,</span> <span class="n">test_loss_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">roc_lists</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">best_val_roc</span><span class="p">,</span> <span class="n">best_val_idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
<span class="n">optimal_loss</span> <span class="o">=</span> <span class="mf">1e10</span>

<span class="k">def</span> <span class="nf">train_general</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">loader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loader</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">global_mean_pool</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="n">batch</span><span class="o">.</span><span class="n">batch</span><span class="p">)</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">output_layer</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">is_valid</span> <span class="o">=</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">loss_mat</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">double</span><span class="p">(),</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">loss_mat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">is_valid</span><span class="p">,</span> <span class="n">loss_mat</span><span class="p">,</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">loss_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">loss_mat</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>

        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">loss_mat</span><span class="p">)</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">is_valid</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="k">global</span> <span class="n">optimal_loss</span>
    <span class="n">temp_loss</span> <span class="o">=</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">temp_loss</span> <span class="o">&lt;</span> <span class="n">optimal_loss</span><span class="p">:</span>
        <span class="n">optimal_loss</span> <span class="o">=</span> <span class="n">temp_loss</span>

    <span class="k">return</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">eval_general</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">loader</span><span class="p">):</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">y_true</span><span class="p">,</span> <span class="n">y_scores</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loader</span><span class="p">):</span>
        <span class="n">batch</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">global_mean_pool</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">batch</span><span class="p">),</span> <span class="n">batch</span><span class="o">.</span><span class="n">batch</span><span class="p">)</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">output_layer</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="n">true</span> <span class="o">=</span> <span class="n">batch</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">y_true</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
        <span class="n">y_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>


    <span class="n">y_true</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">y_scores</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">y_scores</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">roc_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="c1"># AUC is only defined when there is at least one positive data.</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_true</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y_true</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">is_valid</span> <span class="o">=</span> <span class="n">y_true</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">roc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eval_metric</span><span class="p">((</span><span class="n">y_true</span><span class="p">[</span><span class="n">is_valid</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y_scores</span><span class="p">[</span><span class="n">is_valid</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is invalid&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">roc_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">roc_list</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Some target is missing!&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Missing ratio: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">roc_list</span><span class="p">))</span> <span class="o">/</span> <span class="n">y_true</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">roc_list</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">roc_list</span><span class="p">),</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">loader</span><span class="p">),</span> <span class="n">roc_list</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">train_func</span> <span class="o">=</span> <span class="n">train_general</span>
<span class="n">eval_func</span> <span class="o">=</span> <span class="n">eval_general</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">loss_acc</span> <span class="o">=</span> <span class="n">train_func</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Epoch: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Loss: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">loss_acc</span><span class="p">))</span>

    <span class="n">train_roc</span> <span class="o">=</span> <span class="n">train_loss</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">val_roc</span><span class="p">,</span> <span class="n">val_loss</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">eval_func</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">val_loader</span><span class="p">)</span>
    <span class="n">test_roc</span><span class="p">,</span> <span class="n">test_loss</span><span class="p">,</span> <span class="n">roc_list</span> <span class="o">=</span> <span class="n">eval_func</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">)</span>

    <span class="n">train_roc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_roc</span><span class="p">)</span>
    <span class="n">val_roc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_roc</span><span class="p">)</span>
    <span class="n">test_roc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_roc</span><span class="p">)</span>
    <span class="n">train_loss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
    <span class="n">val_loss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_loss</span><span class="p">)</span>
    <span class="n">test_loss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_loss</span><span class="p">)</span>
    <span class="n">roc_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roc_list</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;val: </span><span class="si">{:.6f}</span><span class="se">\t</span><span class="s1">test: </span><span class="si">{:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val_roc</span><span class="p">,</span> <span class="n">test_roc</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">val_roc</span> <span class="o">&gt;</span> <span class="n">best_val_roc</span><span class="p">:</span>
        <span class="n">best_val_roc</span> <span class="o">=</span> <span class="n">val_roc</span>
        <span class="n">best_val_idx</span> <span class="o">=</span> <span class="n">epoch</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch: 1
Loss: 0.7890448979555018
val: 0.493066   test: 0.467586

Epoch: 2
Loss: 0.7206984094669178
val: 0.521066   test: 0.567369

Epoch: 3
Loss: 0.6808990557626126
val: 0.546758   test: 0.583905

Epoch: 4
Loss: 0.6745207162534314
val: 0.571512   test: 0.604082

Epoch: 5
Loss: 0.6650212782655167
val: 0.555260   test: 0.630019

Epoch: 6
Loss: 0.6609979158821531
val: 0.552788   test: 0.629470

Epoch: 7
Loss: 0.6365597884904656
val: 0.545063   test: 0.609288

Epoch: 8
Loss: 0.6325839394666748
val: 0.558695   test: 0.598746

Epoch: 9
Loss: 0.6194784707871628
val: 0.560854   test: 0.613101

Epoch: 10
Loss: 0.6119444207838427
val: 0.545393   test: 0.587247

Epoch: 11
Loss: 0.6084267317479832
val: 0.546163   test: 0.584681

Epoch: 12
Loss: 0.594379795679181
val: 0.550446   test: 0.580790

Epoch: 13
Loss: 0.5814032406936134
val: 0.558260   test: 0.591325

Epoch: 14
Loss: 0.5821246152011825
val: 0.572061   test: 0.609039

Epoch: 15
Loss: 0.5623563324240084
val: 0.572713   test: 0.608568

Epoch: 16
Loss: 0.5629411729916913
val: 0.561830   test: 0.589468

Epoch: 17
Loss: 0.5418217095759776
val: 0.564055   test: 0.575939

Epoch: 18
Loss: 0.5380657321434608
val: 0.590165   test: 0.533879

Epoch: 19
Loss: 0.5214687218438495
val: 0.612862   test: 0.511216

Epoch: 20
Loss: 0.5150101393634872
val: 0.624103   test: 0.540542

Epoch: 21
Loss: 0.4955445477030514
val: 0.634808   test: 0.578347

Epoch: 22
Loss: 0.48988493107218567
val: 0.632235   test: 0.596660

Epoch: 23
Loss: 0.4843246491776333
val: 0.634006   test: 0.589116

Epoch: 24
Loss: 0.46250356726144015
val: 0.610571   test: 0.546207

Epoch: 25
Loss: 0.44351343675443594
val: 0.585388   test: 0.517635

Epoch: 26
Loss: 0.4311040234292012
val: 0.584375   test: 0.506485

Epoch: 27
Loss: 0.42884370231803304
val: 0.583910   test: 0.502525

Epoch: 28
Loss: 0.41645678149041465
val: 0.593627   test: 0.503896

Epoch: 29
Loss: 0.3978502586092939
val: 0.617391   test: 0.506926

Epoch: 30
Loss: 0.3753017187324836
val: 0.635705   test: 0.532077

Epoch: 31
Loss: 0.37998483145674034
val: 0.628083   test: 0.533108

Epoch: 32
Loss: 0.3576763418170913
val: 0.589657   test: 0.512151

Epoch: 33
Loss: 0.33572181544907065
val: 0.559906   test: 0.526929

Epoch: 34
Loss: 0.3245714498859569
val: 0.563185   test: 0.564498

Epoch: 35
Loss: 0.3115902600749161
val: 0.571337   test: 0.583199

Epoch: 36
Loss: 0.30301906367055675
val: 0.564221   test: 0.549889

Epoch: 37
Loss: 0.29085193507140294
val: 0.552433   test: 0.515697

Epoch: 38
Loss: 0.280614545207421
val: 0.549898   test: 0.509258

Epoch: 39
Loss: 0.2638803713267179
val: 0.564261   test: 0.515690

Epoch: 40
Loss: 0.2784722773760675
val: 0.606568   test: 0.533551

Epoch: 41
Loss: 0.23600026165419447
val: 0.620526   test: 0.560151

Epoch: 42
Loss: 0.22487450013132906
val: 0.619791   test: 0.584050

Epoch: 43
Loss: 0.23739796695298396
val: 0.629150   test: 0.596498

Epoch: 44
Loss: 0.20377325739748045
val: 0.575724   test: 0.553914

Epoch: 45
Loss: 0.2042612950155936
val: 0.563912   test: 0.528640

Epoch: 46
Loss: 0.18829806694788767
val: 0.585577   test: 0.558088

Epoch: 47
Loss: 0.18532209452555687
val: 0.584719   test: 0.581878

Epoch: 48
Loss: 0.19661826269119664
val: 0.577035   test: 0.590247

Epoch: 49
Loss: 0.1777977850554482
val: 0.591134   test: 0.614577

Epoch: 50
Loss: 0.1688708345836757
val: 0.621861   test: 0.651868

Epoch: 51
Loss: 0.15549886980732563
val: 0.648588   test: 0.664025

Epoch: 52
Loss: 0.15489401141893733
val: 0.663913   test: 0.664687

Epoch: 53
Loss: 0.14611072828856853
val: 0.662711   test: 0.655157

Epoch: 54
Loss: 0.1414666344323933
val: 0.647173   test: 0.640932

Epoch: 55
Loss: 0.14527067568702584
val: 0.623229   test: 0.626670

Epoch: 56
Loss: 0.14593197044572598
val: 0.606861   test: 0.604167

Epoch: 57
Loss: 0.13939075120189384
val: 0.610515   test: 0.586252

Epoch: 58
Loss: 0.1251759732087336
val: 0.611797   test: 0.538693

Epoch: 59
Loss: 0.1343301963358481
val: 0.616589   test: 0.522969

Epoch: 60
Loss: 0.11001557274238116
val: 0.619285   test: 0.524458

Epoch: 61
Loss: 0.15277526986192563
val: 0.608661   test: 0.545176

Epoch: 62
Loss: 0.11538843484918088
val: 0.609680   test: 0.588619

Epoch: 63
Loss: 0.0985766438425654
val: 0.620455   test: 0.609299

Epoch: 64
Loss: 0.10735864472986267
val: 0.642322   test: 0.621622

Epoch: 65
Loss: 0.10676408858572192
val: 0.639177   test: 0.624693

Epoch: 66
Loss: 0.13325658329221335
val: 0.547236   test: 0.545921

Epoch: 67
Loss: 0.09812393359235637
val: 0.435594   test: 0.449668

Epoch: 68
Loss: 0.11815496698191
val: 0.440811   test: 0.456065

Epoch: 69
Loss: 0.13404194416895196
val: 0.489754   test: 0.533839

Epoch: 70
Loss: 0.09608796220740463
val: 0.537089   test: 0.593275

Epoch: 71
Loss: 0.10191841311042969
val: 0.561824   test: 0.609887

Epoch: 72
Loss: 0.11361937400858171
val: 0.591500   test: 0.622308

Epoch: 73
Loss: 0.10490253882491668
val: 0.610691   test: 0.619335

Epoch: 74
Loss: 0.09490131772865523
val: 0.618027   test: 0.596461

Epoch: 75
Loss: 0.1156856352257912
val: 0.643737   test: 0.597033

Epoch: 76
Loss: 0.09388995478264883
val: 0.652374   test: 0.595091

Epoch: 77
Loss: 0.10811315394162796
val: 0.610649   test: 0.574688

Epoch: 78
Loss: 0.10319929823191863
val: 0.581131   test: 0.597745

Epoch: 79
Loss: 0.10651510424792467
val: 0.609778   test: 0.595701

Epoch: 80
Loss: 0.11681465909044744
val: 0.635403   test: 0.608692

Epoch: 81
Loss: 0.0880049808133542
val: 0.606734   test: 0.588925

Epoch: 82
Loss: 0.10381243157490846
val: 0.573224   test: 0.583282

Epoch: 83
Loss: 0.08876446211393318
val: 0.564409   test: 0.588673

Epoch: 84
Loss: 0.09330504039850987
val: 0.560004   test: 0.597551

Epoch: 85
Loss: 0.08981156514877242
val: 0.557728   test: 0.602097

Epoch: 86
Loss: 0.10622473920822918
val: 0.566855   test: 0.599331

Epoch: 87
Loss: 0.07594522236525558
val: 0.644541   test: 0.594666

Epoch: 88
Loss: 0.07898343053583962
val: 0.656333   test: 0.596486

Epoch: 89
Loss: 0.10304699343774959
val: 0.663899   test: 0.598353

Epoch: 90
Loss: 0.09982285622781926
val: 0.647656   test: 0.589929

Epoch: 91
Loss: 0.08477227768232437
val: 0.637571   test: 0.601520

Epoch: 92
Loss: 0.08859610125810924
val: 0.656620   test: 0.615835

Epoch: 93
Loss: 0.08263467087315893
val: 0.627936   test: 0.593549

Epoch: 94
Loss: 0.09459970997364853
val: 0.599300   test: 0.580668

Epoch: 95
Loss: 0.07965596209709733
val: 0.632426   test: 0.583793

Epoch: 96
Loss: 0.06998769364210963
val: 0.640449   test: 0.580934

Epoch: 97
Loss: 0.08737638635008234
val: 0.634919   test: 0.576853

Epoch: 98
Loss: 0.09454356716638188
val: 0.638173   test: 0.580184

Epoch: 99
Loss: 0.07616965204530123
val: 0.643492   test: 0.600817

Epoch: 100
Loss: 0.0683504562626202
val: 0.633123   test: 0.627766

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;best val: </span><span class="si">{:.6f}</span><span class="se">\t</span><span class="s1">test: </span><span class="si">{:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val_roc_list</span><span class="p">[</span><span class="n">best_val_idx</span><span class="p">],</span> <span class="n">test_roc_list</span><span class="p">[</span><span class="n">best_val_idx</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
best val: 0.663913      test: 0.664687
</pre></div></div>
</div>
</section>
<section id="6.-Gather-the-results-from-5-independent-runs.">
<h2>6. Gather the results from 5 independent runs.<a class="headerlink" href="#6.-Gather-the-results-from-5-independent-runs." title="Permalink to this headline"></a></h2>
<p>Here we omit the results from the other runs and provid the integrated results from three classfication tasks (HIV, MUV and PCBA).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="n">hiv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.5896</span><span class="p">,</span> <span class="mf">0.6812</span><span class="p">,</span> <span class="mf">0.7460</span><span class="p">,</span> <span class="mf">0.7774</span><span class="p">,</span> <span class="mf">0.7768</span><span class="p">,</span> <span class="mf">0.7998</span><span class="p">,</span> <span class="mf">0.8310</span><span class="p">,</span> <span class="mf">0.8411</span><span class="p">,</span> <span class="mf">0.8531</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.6647</span><span class="p">,</span> <span class="mf">0.7389</span><span class="p">,</span> <span class="mf">0.7801</span><span class="p">,</span> <span class="mf">0.7874</span><span class="p">,</span> <span class="mf">0.8040</span><span class="p">,</span> <span class="mf">0.8039</span><span class="p">,</span> <span class="mf">0.8279</span><span class="p">,</span> <span class="mf">0.8237</span><span class="p">,</span> <span class="mf">0.8710</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.6258</span><span class="p">,</span> <span class="mf">0.7037</span><span class="p">,</span> <span class="mf">0.7090</span><span class="p">,</span> <span class="mf">0.8054</span><span class="p">,</span> <span class="mf">0.7857</span><span class="p">,</span> <span class="mf">0.7734</span><span class="p">,</span> <span class="mf">0.8187</span><span class="p">,</span> <span class="mf">0.8396</span><span class="p">,</span> <span class="mf">0.8412</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.6458</span><span class="p">,</span> <span class="mf">0.6869</span><span class="p">,</span> <span class="mf">0.7464</span><span class="p">,</span> <span class="mf">0.7768</span><span class="p">,</span> <span class="mf">0.7636</span><span class="p">,</span> <span class="mf">0.7932</span><span class="p">,</span> <span class="mf">0.8067</span><span class="p">,</span> <span class="mf">0.8415</span><span class="p">,</span> <span class="mf">0.8501</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.6432</span><span class="p">,</span> <span class="mf">0.6805</span><span class="p">,</span> <span class="mf">0.7669</span><span class="p">,</span> <span class="mf">0.7776</span><span class="p">,</span> <span class="mf">0.8186</span><span class="p">,</span> <span class="mf">0.7801</span><span class="p">,</span> <span class="mf">0.7892</span><span class="p">,</span> <span class="mf">0.8428</span><span class="p">,</span> <span class="mf">0.8326</span><span class="p">]</span>
<span class="p">])</span>
<span class="n">muv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.4381</span><span class="p">,</span> <span class="mf">0.5454</span><span class="p">,</span> <span class="mf">0.5818</span><span class="p">,</span> <span class="mf">0.6727</span><span class="p">,</span> <span class="mf">0.7621</span><span class="p">,</span> <span class="mf">0.6712</span><span class="p">,</span> <span class="mf">0.7054</span><span class="p">,</span> <span class="mf">0.7617</span><span class="p">,</span> <span class="mf">0.8068</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.5378</span><span class="p">,</span> <span class="mf">0.6388</span><span class="p">,</span> <span class="mf">0.6178</span><span class="p">,</span> <span class="mf">0.7187</span><span class="p">,</span> <span class="mf">0.7038</span><span class="p">,</span> <span class="mf">0.7215</span><span class="p">,</span> <span class="mf">0.7386</span><span class="p">,</span> <span class="mf">0.7834</span><span class="p">,</span> <span class="mf">0.8024</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.4707</span><span class="p">,</span> <span class="mf">0.5556</span><span class="p">,</span> <span class="mf">0.5380</span><span class="p">,</span> <span class="mf">0.6610</span><span class="p">,</span> <span class="mf">0.6668</span><span class="p">,</span> <span class="mf">0.7252</span><span class="p">,</span> <span class="mf">0.7222</span><span class="p">,</span> <span class="mf">0.7891</span><span class="p">,</span> <span class="mf">0.8183</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.4498</span><span class="p">,</span> <span class="mf">0.5724</span><span class="p">,</span> <span class="mf">0.5653</span><span class="p">,</span> <span class="mf">0.6855</span><span class="p">,</span> <span class="mf">0.6907</span><span class="p">,</span> <span class="mf">0.6618</span><span class="p">,</span> <span class="mf">0.7230</span><span class="p">,</span> <span class="mf">0.7255</span><span class="p">,</span> <span class="mf">0.7780</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.4755</span><span class="p">,</span> <span class="mf">0.6006</span><span class="p">,</span> <span class="mf">0.6749</span><span class="p">,</span> <span class="mf">0.7079</span><span class="p">,</span> <span class="mf">0.7379</span><span class="p">,</span> <span class="mf">0.7317</span><span class="p">,</span> <span class="mf">0.7554</span><span class="p">,</span> <span class="mf">0.8083</span><span class="p">,</span> <span class="mf">0.7814</span><span class="p">]</span>
<span class="p">])</span>
<span class="n">pcba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.0524</span><span class="p">,</span> <span class="mf">0.0958</span><span class="p">,</span> <span class="mf">0.1296</span><span class="p">,</span> <span class="mf">0.1750</span><span class="p">,</span> <span class="mf">0.1961</span><span class="p">,</span> <span class="mf">0.2161</span><span class="p">,</span> <span class="mf">0.2468</span><span class="p">,</span> <span class="mf">0.2673</span><span class="p">,</span> <span class="mf">0.2829</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0502</span><span class="p">,</span> <span class="mf">0.0942</span><span class="p">,</span> <span class="mf">0.1339</span><span class="p">,</span> <span class="mf">0.1823</span><span class="p">,</span> <span class="mf">0.2087</span><span class="p">,</span> <span class="mf">0.2303</span><span class="p">,</span> <span class="mf">0.2534</span><span class="p">,</span> <span class="mf">0.2733</span><span class="p">,</span> <span class="mf">0.2809</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0526</span><span class="p">,</span> <span class="mf">0.0961</span><span class="p">,</span> <span class="mf">0.1339</span><span class="p">,</span> <span class="mf">0.1691</span><span class="p">,</span> <span class="mf">0.1912</span><span class="p">,</span> <span class="mf">0.2161</span><span class="p">,</span> <span class="mf">0.2443</span><span class="p">,</span> <span class="mf">0.2625</span><span class="p">,</span> <span class="mf">0.2735</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0512</span><span class="p">,</span> <span class="mf">0.0952</span><span class="p">,</span> <span class="mf">0.1302</span><span class="p">,</span> <span class="mf">0.1836</span><span class="p">,</span> <span class="mf">0.2048</span><span class="p">,</span> <span class="mf">0.2203</span><span class="p">,</span> <span class="mf">0.2551</span><span class="p">,</span> <span class="mf">0.2662</span><span class="p">,</span> <span class="mf">0.2791</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.0542</span><span class="p">,</span> <span class="mf">0.0995</span><span class="p">,</span> <span class="mf">0.1327</span><span class="p">,</span> <span class="mf">0.1775</span><span class="p">,</span> <span class="mf">0.2000</span><span class="p">,</span> <span class="mf">0.2262</span><span class="p">,</span> <span class="mf">0.2448</span><span class="p">,</span> <span class="mf">0.2713</span><span class="p">,</span> <span class="mf">0.2794</span><span class="p">]</span>
<span class="p">])</span>
<span class="n">data_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">hiv</span><span class="p">,</span> <span class="n">muv</span><span class="p">,</span> <span class="n">pcba</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="7.-Fit-the-curve-and-plot-the-neural-scaling-law.">
<h2>7. Fit the curve and plot the neural scaling law.<a class="headerlink" href="#7.-Fit-the-curve-and-plot-the-neural-scaling-law." title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">power_law</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_list</span><span class="p">):</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">power_law</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">)</span>

    <span class="n">mean_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">std_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">max_data</span> <span class="o">=</span> <span class="n">mean_data</span> <span class="o">+</span> <span class="n">std_data</span>
    <span class="n">min_data</span> <span class="o">=</span> <span class="n">mean_data</span> <span class="o">-</span> <span class="n">std_data</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">max_data</span><span class="p">,</span> <span class="n">min_data</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean_data</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">power_law</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">max_data</span><span class="p">,</span> <span class="n">min_data</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean_data</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">power_law</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Select Ratio&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ROC-AUC&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;1%&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;10%&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;30%&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;60%&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;100%&#39;</span><span class="p">])</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Select Ratio&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ROC-AUC&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;1%&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;10%&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;30%&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;60%&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;100%&#39;</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>


<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AP&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;AP&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(a) HIV&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(b) MUV&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(c) PCBA&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(d) HIV (log-log)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(e) MUV (log-log)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;(f) PCBA (log-log)&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_18_0.png" src="_images/example_18_0.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="environment.html" class="btn btn-neutral float-left" title="Prepare Environment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="run.html" class="btn btn-neutral float-right" title="Experiments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Dingshuo Chen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>